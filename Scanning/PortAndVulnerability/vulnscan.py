#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Check the ports against the banners
@filename vulnscan.py
@version 0.01 (python ver 3.8.2)
@author Douglas Quintiliano dos Santos
"""

import socket
import os
import sys


RESET, GREEN, RED = '\033[0m', '\033[92m', '\033[91m' 

def retBanner(ip,port):
  try:
    socket.setdefaulttimeout(2)
    s = socket.socket()
    s.connect((ip,port))
    banner = s.recv(1024).strip().decode()
    return banner
  except:
    return

def checkVulns(banner, filename):
  f = open(filename, "r")
  for line in f.readlines():
    if line.strip("\n") in banner:
      print('[{}+{}] Server is vulnerable: {}{}{} '.format(GREEN,RESET,GREEN,banner.strip("\n"),RESET))

def main():
  if len(sys.argv) == 2:
    filename = sys.argv[1]
    if not os.path.isfile(filename):
      print('[-] File Does not Exist!')
      exit(0)
    if not os.access(filename, os.R_OK):
      print('[-] Access Denied!')
      exit(0)
  else:
    print('[-] Usage: {} <vuln filename>'.format(str(sys.argv[0])))
    exit(0)


  portlist = [21,22,25,80,110,443,445]
  for x in range(50,51):
    ip = "10.0.0." + str(x)
    for port in portlist:
      banner = retBanner(ip,port)
      if banner:
        print('[{}!!{}] {}/{} : {}'.format(RED,RESET,ip,str(port),banner))
        checkVulns(banner,filename)

if __name__ == "__main__":
    main()